{"version":3,"names":["TurndownService","require","gfm","createMarkdownConverter","td","headingStyle","codeBlockStyle","use","addRule","filter","node","nodeName","getAttribute","replacement","content","localId","localName","originalName","innerText","trim","ext","includes","split","pop","linkId","text","src","url","replace","classes","className","style","result","isFirstRow","parentElement","firstElementChild","cells","querySelectorAll","Array","from","map","join","module","exports"],"sources":["parser.js"],"sourcesContent":["const TurndownService = require('turndown');\nconst { gfm } = require('turndown-plugin-gfm');\n\n/**\n * Creates a configured TurndownService instance with OneNote-specific rules\n * @returns {TurndownService} Configured Turndown instance\n */\nfunction createMarkdownConverter() {\n    const td = new TurndownService({\n        headingStyle: 'atx',\n        codeBlockStyle: 'fenced'\n    });\n    td.use(gfm);\n\n    // Rule to handle images with our custom data-local-src attribute (Obsidian style)\n    td.addRule('localImages', {\n        filter: (node) => node.nodeName === 'IMG' && node.getAttribute('data-local-src'),\n        replacement: (content, node) => {\n            const localId = node.getAttribute('data-local-src');\n            return `![[assets/${localId}.png]]`;\n        }\n    });\n\n    // Rule for local file attachments (Obsidian style)\n    td.addRule('localFiles', {\n        filter: (node) => node.nodeName === 'A' && node.getAttribute('data-local-file'),\n        replacement: (content, node) => {\n            const localName = node.getAttribute('data-local-file');\n            // Prefer the explicitly passed filename from scraper, falling back to text\n            const originalName = node.getAttribute('data-filename') || node.innerText.trim() || 'file';\n            const ext = originalName.includes('.') ? originalName.split('.').pop() : 'bin';\n            return `[[assets/${localName}.${ext}]]`;\n        }\n    });\n\n    // Rule for internal cross-links\n    td.addRule('internalLinks', {\n        filter: (node) => node.nodeName === 'A' && node.getAttribute('data-internal-link'),\n        replacement: (content, node) => {\n            const linkId = node.getAttribute('data-internal-link');\n            const text = node.innerText.trim();\n            // Use a specific marker for post-processing\n            return `[[${text}]]<!-- onenote-link:${linkId} -->`;\n        }\n    });\n\n    // Rule for YouTube/Vimeo embeds\n    td.addRule('embeds', {\n        filter: (node) => node.nodeName === 'IFRAME' && node.getAttribute('data-embed-id'),\n        replacement: (content, node) => {\n            const src = node.getAttribute('src');\n            // Convert embed URLs back to watch URLs if possible\n            let url = src;\n            if (src.includes('youtube.com/embed/')) {\n                url = src.replace('youtube.com/embed/', 'youtube.com/watch?v=');\n            } else if (src.includes('player.vimeo.com/video/')) {\n                url = src.replace('player.vimeo.com/video/', 'vimeo.com/');\n            }\n            return `\\n\\n[Video Link](${url})\\n\\n`;\n        }\n    });\n\n    // Rule for local videos with data-local-video (Obsidian style)\n    td.addRule('localVideos', {\n        filter: (node) => node.nodeName === 'VIDEO' && node.getAttribute('data-local-video'),\n        replacement: (content, node) => {\n            const localId = node.getAttribute('data-local-video');\n            return `\\n\\n![[assets/${localId}.mp4]]\\n\\n`;\n        }\n    });\n\n    // Rule for Strikethrough (OneNote specific)\n    td.addRule('strikethrough', {\n        filter: (node) => {\n            const classes = typeof node.className === 'string' ? node.className : '';\n            const style = node.getAttribute('style') || '';\n            return classes.includes('Strikethrough') || style.includes('text-decoration: line-through');\n        },\n        replacement: (content) => `~~${content}~~`\n    });\n\n    // Rule to ignore OneNote table junk (resize handles, hover UI, etc.)\n    td.addRule('ignoreTableJunk', {\n        filter: (node) => {\n            const classes = node.className || '';\n            // REMOVED 'RelativeElementContainer' as it often wraps images we want to keep\n            // REMOVED 'role=\"presentation\"' as it is used for image containers\n            return classes.includes('TableHover') ||\n                classes.includes('TableInsertRowGap') ||\n                classes.includes('TableColumnHandle') ||\n                classes.includes('TableColumnWidthSpacer') ||\n                classes.includes('TableColumnResizeHandle');\n        },\n        replacement: () => ''\n    });\n\n    // Rule for OutlineContainer to ensure block separation\n    td.addRule('outlines', {\n        filter: (node) => typeof node.className === 'string' && node.className.includes('OutlineContainer'),\n        replacement: (content) => `\\n\\n${content}\\n\\n`\n    });\n\n    // Ensure table cells are treated as such even with weird roles\n    td.addRule('tableCells', {\n        filter: (node) => (node.nodeName === 'TD' || node.nodeName === 'TH') ||\n            (node.getAttribute('role') === 'rowheader' || node.getAttribute('role') === 'columnheader'),\n        replacement: function (content, node) {\n            // Trim and ensure no newlines inside cells for GFM compat\n            return '| ' + content.trim().replace(/\\n/g, ' ') + ' ';\n        }\n    });\n\n    // We need a custom table row rule because OneNote doesn't always use standard table structures\n    td.addRule('tableRow', {\n        filter: 'tr',\n        replacement: function (content, node) {\n            let result = content + '|\\n';\n            // If it's the first row, add the GFM separator\n            const isFirstRow = node === node.parentElement.firstElementChild;\n            if (isFirstRow) {\n                const cells = node.querySelectorAll('td, th, [role*=\"header\"]');\n                result += '|' + Array.from(cells).map(() => ' --- ').join('|') + '|\\n';\n            }\n            return result;\n        }\n    });\n\n    // Custom table rule to just wrap the content\n    td.addRule('table', {\n        filter: 'table',\n        replacement: function (content) {\n            return '\\n\\n' + content + '\\n\\n';\n        }\n    });\n\n    return td;\n}\n\nmodule.exports = { createMarkdownConverter };\n"],"mappings":"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","ignoreList":[]}